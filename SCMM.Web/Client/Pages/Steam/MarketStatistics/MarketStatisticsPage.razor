@page "/steam/marketstatistics"
@using SCMM.Web.Shared
@using SCMM.Steam.Shared
@using Web.Shared.Data.Models.Steam
@using Web.Shared.Data.Models.UI
@using Web.Shared.Data.Models.UI.MarketStatistics
@inject ILogger<MarketStatisticsPage> Logger
@inject NavigationManager Navigation
@inject HttpClient Http
@inject IJSRuntime JSRuntime
@inject AppState State

<style>

    .Dashboard-Card, .Dashboard-Chart-Card {
        display: flex;
        flex-flow: column;
        height: 100%;
    }
    
    .Dashboard-Card .CardHeader-Root {
        flex: 0 1 auto;
    }

    .Dashboard-Card .CardContent-Root {
        flex: 1 1 auto;
        height: 500px;
        overflow-y: auto;
        padding: 0px;
    }

</style>

<Title Value="Market Statistics" />
<Grid Container Spacing="@Spacing.Two">

    <Grid Item ExtraSmall="@GridSize.Twelve">
        <Alert Severity="@Severity.Info" Variant="@AlertVariant.Outlined">
            <IconContent>
                <DiscordBotIcon />
            </IconContent>
            <ChildContent>
                <AlertTitle>SCMM Discord Bot</AlertTitle>
                <span>Beep Boop! Did you know I can join your Discord community to provide tools and alerts for the Steam community marketplace? Click the <a @onclick="InviteDiscordBot">invite button</a> to get started.</span>
            </ChildContent>
            <ActionContent>
                <Button Color="@Color.Inherit" Size="@Size.Large"
                        OnClick="@(() => InviteDiscordBot())">
                    INVITE
                </Button>
        </ActionContent>
        </Alert>
    </Grid>

    <Grid Item ExtraSmall="@GridSize.Twelve" ExtraLarge="@GridSize.Six">    
        <Card Class="Dashboard-Chart-Card">
            <CardHeader>
                <TitleContent>
                    <Grid Container>
                        <Grid Item ExtraSmall="@GridSize.Twelve" Small="@GridSize.Three">
                            <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                                Market Sales
                            </Typography>
                            <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                                Total number of sales per day
                            </Typography>
                        </Grid>
                        <Grid Item Container ExtraSmall="@GridSize.Twelve" Small="@GridSize.Nine" Style="flex-direction: row-reverse">
                            <Button OnClick="@(() => RefreshSalesPerDay(null))" Color="@Color.TextSecondary">
                                All
                            </Button>
                            <Divider Orientation="@Orientation.Vertical" />
                            <Button OnClick="@(() => RefreshSalesPerDay(365))" Color="@Color.TextSecondary">
                                12m
                            </Button>
                            <Divider Orientation="@Orientation.Vertical" />
                            <Button OnClick="@(() => RefreshSalesPerDay(182))" Color="@Color.TextSecondary">
                                6m
                            </Button>
                            <Divider Orientation="@Orientation.Vertical" />
                            <Button OnClick="@(() => RefreshSalesPerDay(30))" Color="@Color.TextSecondary">
                                1m
                            </Button>
                            @if (SalesToday > 0)
                            {
                                <Divider Orientation="@Orientation.Vertical" />
                                <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary" Style="display: flex; align-items: center; align-content: center; padding: 8px 16px;">
                                    <strong>@SalesToday.ToQuantityString() sales today</strong>
                                </Typography>
                            }
                        </Grid>
                    </Grid>
                </TitleContent>
            </CardHeader>
            <CardContent>
                @if (SalesPerDayChart == null)
                {
                    <Loading />
                }
                else
                {
                    <ChartJsLineChart @ref="SalesPerDayChartJs" Config="@SalesPerDayChart" />
                }
            </CardContent>
        </Card>
    </Grid>
    
    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Hot Right Now
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items with the highest number of sales in the past 24hrs.
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableBody>
                        <Virtualize ItemsProvider="LoadHotRightNow" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.Last24hrSales.ToSalesActivityString()</span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>

    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Most Recent
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items with the lowest market age.
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableBody>
                        <Virtualize ItemsProvider="LoadMostRecent" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.MarketAge</span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>

    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        <img src="/images/stonks-guy.png" style="width:24px; margin-right: -10px;" />
                        📈 Stonking
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items currently at their all-time highest value.
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableBody>
                        <Virtualize ItemsProvider="LoadAllTimeHigh" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.Currency.ToPriceString(item.Last1hrValue)</span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>

    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        <img src="/images/stonks-guy.png" style="width:24px; margin-right: -10px;" />
                        📉 Crashing
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items currently at their all-time lowest value.
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableBody>
                        <Virtualize ItemsProvider="LoadAllTimeLow" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.Currency.ToPriceString(item.Last1hrValue)</span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>
    
    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Profitable Flips
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items with the largest gap in asking price vs buy now price with a upward trending average price. These items can be profitable if you are able to buy low and then sell high after the seven day market cooldown.
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableHead>
                        <TableRow>
                            <TableCell></TableCell>
                            <TableCell>Buy At</TableCell>
                            <TableCell>Potential Profit</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody>
                        <Virtualize ItemsProvider="LoadProfitableFlips" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.Currency.ToPriceString(item.BuyAskingPrice)</span>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap Text-Success">@item.Currency.ToPriceString(item.BuyNowPrice - item.BuyAskingPrice - ((long)Math.Floor(Math.Max(item.BuyNowPrice * SteamEconomyHelper.SteamFeeMultiplier, 1))))</span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>
    
    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Most Profitable
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items with the highest current market value.
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableBody>
                        <Virtualize ItemsProvider="LoadMostProfitable" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.Currency.ToPriceString(item.Last1hrValue)</span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>
    
    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Most Popular
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items with them highest number of unique owners (subscribers).
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableBody>
                        <Virtualize ItemsProvider="LoadMostPopular" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">
                                            <i class="fas fa-fw fa-user"></i>
                                            @item.Subscriptions.ToQuantityString()
                                        </span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>

    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Most Saturated
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Items with the highest number of listings on the marketplace
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableHead>
                        <TableRow>
                            <TableCell></TableCell>
                            <TableCell>Supply</TableCell>
                            <TableCell>Demand</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody>
                        <Virtualize ItemsProvider="LoadMostSaturated" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewItem(item))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.IconUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px"><span style="@GetItemStyles(item)">@item.Name</span></strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <strong class="Text-NoWrap">@item.Supply.ToQuantityString()</strong>
                                    </TableCell>
                                    <TableCell>
                                        @if (item.Demand > 0)
                                        {
                                            <span>@item.Demand.ToQuantityString() sold yesterday</span>
                                        }
                                        else 
                                        {
                                            <span>None sold yesterday</span>
                                        }
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>
    
    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Skin High Rollers
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Users with the highest inventory value. (based on known SCMM users only)
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableHead>
                        <TableRow>
                            <TableCell></TableCell>
                            <TableCell>Items</TableCell>
                            <TableCell>Market Value</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody>
                        <Virtualize ItemsProvider="LoadHighRollers" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewProfile(item.SteamId))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.AvatarUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">@item.Name</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.TotalItems.ToQuantityString()</span>
                                    </TableCell>
                                    <TableCell>
                                        <span class="Text-NoWrap">@item.Currency.ToPriceString(item.MarketValue)</span>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>
    
    <Grid Item ExtraSmall="@GridSize.Twelve" Medium="@GridSize.Six" ExtraLarge="@GridSize.Three">
        <Card Class="Dashboard-Card">
            <CardHeader>
                <TitleContent>
                    <Typography Variant="TypographyVariant.H6" Color="@Color.TextPrimary">
                        Skin Creators
                    </Typography>
                    <Typography Variant="TypographyVariant.Body2" Color="@Color.TextSecondary">
                        Creators with the highest number of accepted in-game skins.
                    </Typography>
                </TitleContent>
            </CardHeader>
            <CardContent>
                <Table Size="@Size.Small">
                    <TableHead>
                        <TableRow>
                            <TableCell></TableCell>
                            <TableCell>Items</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody>
                        <Virtualize ItemsProvider="LoadAcceptedCreators" Context="item">
                            <ItemContent>
                                <TableRow Hover OnClick="@((_) => ViewProfile(item.SteamId))">
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="@item.AvatarUrl" style="max-width:32px; max-height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">@item.Name</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>
                                        <strong class="Text-NoWrap">@item.Items.ToQuantityString()</strong>
                                    </TableCell>
                                </TableRow>
                            </ItemContent>
                            <Placeholder>
                                <TableRow>
                                    <TableCell>
                                        <div style="display:flex; align-content:center; align-items:center">
                                            <img src="/images/loading.gif" style="width:32px; height:32px; margin:-4px 0px;" />
                                            <strong style="margin:8px">Loading...</strong>
                                        </div>
                                    </TableCell>
                                    <TableCell>—</TableCell>
                                </TableRow>
                            </Placeholder>
                        </Virtualize>
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    </Grid>
    
</Grid>

@code {

    private int SalesToday { get; set; }
    private IDictionary<string, DashboardSalesDataDTO> SalesPerDay { get; set; }
    private ChartJsLineChart SalesPerDayChartJs;
    private LineConfig SalesPerDayChart;
    
    protected override async Task OnInitializedAsync()
    {
        await RefreshSalesPerDay(30);
    }

    private void InviteDiscordBot()
    {
        JSRuntime.InvokeVoidAsync("WindowInterop.openInNewTab", "https://discord.com/api/oauth2/authorize?client_id=761034518424715264&permissions=2048&scope=bot");
    }

    private void ViewItem(ISteamMarketListing item)
    {
        string url = $"https://steamcommunity.com/market/listings/{item.SteamAppId}/{Uri.EscapeDataString(item.Name)}";
        JSRuntime.InvokeVoidAsync("WindowInterop.openInNewTab", url);
    }
    
    private void ViewProfile(string steamId)
    {
        string url = $"https://steamcommunity.com/profiles/{steamId}";
        JSRuntime.InvokeVoidAsync("WindowInterop.openInNewTab", url);
    }
    
    private string GetItemStyles(ISteamAssetStyles item)
    {
        return $"color: {item.ForegroundColour}";
    }

    private async Task RefreshSalesPerDay(int? maxDays = null)
    {
        try
        {
            SalesToday = 0;
            SalesPerDay = null;
            SalesPerDayChart = null;
            StateHasChanged();
            SalesToday = await Http.GetFromJsonAsync<int>($"api/market/dashboard/salesToday");
            SalesPerDay = await Http.GetFromJsonAsync<IDictionary<string, DashboardSalesDataDTO>>($"api/market/dashboard/salesPerDay?maxDays={maxDays}");
            RedrawSalesPerDayChart();
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'sales per day' market dashboard");
        }
    }

    private void RedrawSalesPerDayChart()
    {
        SalesPerDayChart = new LineConfig
        {
            Options = new LineOptions
            {
                Legend = new Legend
                {
                    Display = false,
                    Labels = new LegendLabelConfiguration()
                    {
                        FontColor = "#ffffff"
                    }
                },
                Responsive = true,
                Tooltips = new Tooltips
                {
                    Enabled = true
                },
                Scales = new Scales
                {

                    xAxes = new List<CartesianAxis>
                    {
                        new CategoryAxis
                        {
                            Ticks = new CategoryTicks()
                            {
                                Display = true,
                                FontColor = "#999999"
                            },
                            ScaleLabel = new ScaleLabel()
                            {
                                Display = true,
                                FontColor = "#ffffff"
                            },
                            GridLines = new GridLines
                            {
                                Display = true,
                                Color = "#999999"
                            }
                        }
                    },
                    yAxes = new List<CartesianAxis>
                    {
                        new LinearCartesianAxis
                        {
                            Ticks = new LinearCartesianTicks()
                            {
                                Display = true,
                                FontColor = "#ffffff",
                                BeginAtZero = true
                            },
                            ScaleLabel = new ScaleLabel()
                            {
                                Display = true,
                                FontColor = "#999999"
                            },
                            GridLines = new GridLines
                            {
                                Display = true,
                                Color = "#999999"
                            }
                        }
                    }
                }
            }
        };

        SalesPerDayChart.Data.Labels = SalesPerDay.Keys.ToList();

        var salesDataSet = new LineDataset<DoubleWrapper>
        {
            Label = "Market Sales",
            BackgroundColor = "#000000",
            BorderColor = "#000000",
            BorderWidth = 2,
            PointBorderWidth = 2,
            //LineTension = 0.1,
            Fill = false
        };
        if (SalesPerDay.Count >= 500)
        {
            salesDataSet.PointRadius = 1;
        }
        else if (SalesPerDay.Count >= 300)
        {
            salesDataSet.PointRadius = 2;
        }
        else if (SalesPerDay.Count >= 150)
        {
            salesDataSet.PointRadius = 3;
        }
        else
        {
            salesDataSet.PointRadius = 4;
        }
        salesDataSet.AddRange(
            SalesPerDay.Select(x => (DoubleWrapper)x.Value.Sales).ToList()
        );

        SalesPerDayChart.Data.Datasets.Add(salesDataSet);
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetSalesDTO>> LoadHotRightNow(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetSalesDTO>>($"api/market/dashboard/hotRightNow?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetSalesDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'hot right now' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetAgeDTO>> LoadMostRecent(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetAgeDTO>>($"api/market/dashboard/mostRecent?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetAgeDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most recent' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetMarketValueDTO>> LoadAllTimeHigh(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetMarketValueDTO>>($"api/market/dashboard/allTimeHigh?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetMarketValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'all time high' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetMarketValueDTO>> LoadAllTimeLow(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetMarketValueDTO>>($"api/market/dashboard/allTimeLow?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetMarketValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'all time low' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetBuyOrderValueDTO>> LoadProfitableFlips(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetBuyOrderValueDTO>>($"api/market/dashboard/profitableFlips?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetBuyOrderValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'profitable flips' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetMarketValueDTO>> LoadMostProfitable(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetMarketValueDTO>>($"api/market/dashboard/mostProfitable?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetMarketValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most profitable' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetSubscriptionsDTO>> LoadMostPopular(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetSubscriptionsDTO>>($"api/market/dashboard/mostPopular?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetSubscriptionsDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most popular' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetSupplyDemandDTO>> LoadMostSaturated(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetSupplyDemandDTO>>($"api/market/dashboard/mostSaturated?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetSupplyDemandDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most staurated' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardProfileInventoryValueDTO>> LoadHighRollers(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardProfileInventoryValueDTO>>($"api/market/dashboard/highRollers?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardProfileInventoryValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'high rollers' market dashboard");
            throw;
        }
    }

    protected async ValueTask<ItemsProviderResult<DashboardProfileWorkshopValueDTO>> LoadAcceptedCreators(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardProfileWorkshopValueDTO>>($"api/market/dashboard/acceptedCreators?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardProfileWorkshopValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'accepted creators' market dashboard");
            throw;
        }
    }
}
