@inject ILogger<RuntimePicker> Logger
@inject NavigationManager NavigationManager
@inject AppState State

<div @attributes="AdditionalAttributes">
    <MudMenu ActivationEvent="@MouseEvent.MouseOver" Direction="MudBlazor.Direction.Right" AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.TopCenter" Dense="true" MaxHeight="500" Disabled="State.IsPrerendering" title="Change runtime mode">
        <ActivatorContent>
            <MudIconButton Icon="@((State.Runtime == RuntimeType.Server) ? "fas fa-fw fa-server" : "fas fa-fw fa-desktop")" Size="MudBlazor.Size.Medium" Disabled="State.IsPrerendering"></MudIconButton>
        </ActivatorContent>
        <ChildContent>
            <MudMenuItem OnClick="@(() => ChangeRuntime(RuntimeType.Server))" Class="d-flex align-center">
                <MudText Typo="Typo.body1"  Class="d-flex align-center">
                    <i class="fas fa-fw fa-server" />
                    <span class="ml-2">@RuntimeType.Server.GetDisplayName()</span>
                </MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="d-flex align-center">
                    <span>Use server-side rendering</span>
                </MudText>
            </MudMenuItem>
            <MudMenuItem OnClick="@(() => ChangeRuntime(RuntimeType.WebAssembly))" Class="d-flex align-center">
                <MudText Typo="Typo.body1" Class="d-flex align-center">
                    <i class="fas fa-fw fa-desktop" />
                    <span class="ml-2">@RuntimeType.WebAssembly.GetDisplayName()</span>
                </MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="d-flex align-center">
                    <span>Use client-side rendering</span>
                </MudText>
            </MudMenuItem>
        </ChildContent>
    </MudMenu>
</div>

@code
{
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object> AdditionalAttributes { get; set; }
    
    private void ChangeRuntime(RuntimeType runtime)
    {
        Logger.LogInformation($"Runtime was changed to '{runtime}'");
        State.Runtime = runtime;

        NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true, replace: true);
    }
}
