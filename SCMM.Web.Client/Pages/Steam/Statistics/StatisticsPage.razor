@page "/stats"
@page "/steam/marketstatistics"
@using SCMM.Steam.Data.Models
@using SCMM.Steam.Data.Models.Enums
@using SCMM.Web.Data.Models
@using SCMM.Web.Data.Models.Steam
@using SCMM.Web.Data.Models.UI
@using SCMM.Web.Data.Models.UI.MarketStatistics
@inject ILogger<StatisticsPage> Logger
@inject IDialogService Dialogs
@inject NavigationManager NavigationManager
@inject ExternalNavigationManager ExternalNavigationManager
@inject HttpClient Http
@inject AppState State

<PageContainer Title="Market Statistics">

    <MudGrid Spacing="2">

        <MudItem xs="12" xl="12">
            <StatisticsPanel Icon="fas fa-fw fa-chart-line" Title="Daily Market Sales" Subtitle="How many items are brought and sold on the market each day? How much money is traded each day? Is the market becoming more active, or less active?">
                <ChildContent>
                    <svg style="height: 0">
                        <defs>
                            <linearGradient id="gradient-chart" x1="0" x2="0" y1="0" y2="1">
                                <stop offset="0" />
                                <stop offset="1" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <style>
                        #MarketSalesPerDay_Series_1_TrendLine_0 {
                            stroke-dasharray: 10px 10px;
                            stroke-linejoin: round;
                            stroke-linecap: round;
                            -webkit-animation: dash 1s linear infinite;
                            animation: dash 1s linear infinite;
                        }
                        @@-webkit-keyframes dash {
                            100% {
                                stroke-dashoffset: -20px;
                            }
                        }
                        @@keyframes dash {
                            100% {
                                stroke-dashoffset: -20px;
                            }
                        }
                    </style>
                    <SfChart ID="MarketSalesPerDay" Theme="Syncfusion.Blazor.Theme.MaterialDark" Background="transparent" Width="100%" Height="100%">
                        <SfDataManager Url="api/market/stat/salesPerDay" Adaptor="Adaptors.WebApiAdaptor"></SfDataManager>
                        <ChartArea>
                            <ChartAreaBorder Width="0"></ChartAreaBorder>
                        </ChartArea>
                        <ChartPrimaryXAxis ValueType="Syncfusion.Blazor.Charts.ValueType.DateTime" IntervalType="IntervalType.Auto" Format="d-MMM-yy" LabelIntersectAction="LabelIntersectAction.Rotate90" EdgeLabelPlacement="EdgeLabelPlacement.Shift">
                        </ChartPrimaryXAxis>
                        <ChartAxes>
                            <ChartAxis Name="RevenueAxis" LabelFormat="@($"{State.Currency.PrefixText}#,##0.00{State.Currency.SuffixText}")" EdgeLabelPlacement="EdgeLabelPlacement.Shift" OpposedPosition="true" />
                            <ChartAxis Name="SalesAxis" LabelFormat="#,##" EdgeLabelPlacement="EdgeLabelPlacement.Shift" />
                        </ChartAxes>
                        <ChartSeriesCollection>
                            <ChartSeries XName="date" YName="revenue" YAxisName="RevenueAxis" Opacity="1" Name="Market Revenue" Width="2" Fill="#388e3c" Type="ChartSeriesType.Line">
                            </ChartSeries>
                            <ChartSeries XName="date" YName="sales" YAxisName="SalesAxis" Opacity="1" Name="Market Sales" Width="2" Fill="#66c0f4" Type="ChartSeriesType.Line">
                                <ChartSeriesBorder Width="1" Color="#1b5e20"></ChartSeriesBorder>
                                <ChartTrendlines>
                                    <ChartTrendline Type="TrendlineTypes.MovingAverage" Period="30" BackwardForecast="30" Width="3" Name="Market Sales Trend" Fill="#fff">
                                    </ChartTrendline>
                                </ChartTrendlines>
                            </ChartSeries>
                        </ChartSeriesCollection>
                        <ChartZoomSettings EnableSelectionZooming="true" EnableMouseWheelZooming="true" EnablePinchZooming="true" Mode="ZoomMode.X"></ChartZoomSettings>
                        <ChartCrosshairSettings Enable="true" LineType="LineType.Vertical"></ChartCrosshairSettings>
                        <ChartTooltipSettings Enable="true" Shared="true"></ChartTooltipSettings>
                        <ChartLegendSettings Visible="true"></ChartLegendSettings>
                    </SfChart>
                </ChildContent>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-star" Title="Latest Items" Subtitle="What are the newest accepted in-game items?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadMostRecent" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.MarketAge</MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>

        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-fire" Title="Hot Right Now" Subtitle="What items have been brought/sold the most in the past 24hrs?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadHotRightNow" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.Last24hrSales.ToQuantityString() sold</MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>

        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-arrow-up" Title="Stonking" Subtitle="What items are at their all-time highest value?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadAllTimeHigh" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.Currency.ToPriceString(item.BuyNowPrice)</MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>

        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-arrow-down" Title="Crashing" Subtitle="What items are at their all-time lowest value?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadAllTimeLow" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.Currency.ToPriceString(item.BuyNowPrice)</MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-dice-five" Title="Profitable Flips" Subtitle="What items have the largest gap in asking price vs buy now price, with an upward trending average price? It's a gamble, but these items can potentially be flipped for profit if you are able to buy low and then sell high after the seven day market cooldown." Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <thead>
                            <tr>
                                <th></th>
                                <th class="NoWrap">Buy At</th>
                                <th class="NoWrap TextRight">Potential Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <Virtualize ItemsProvider="LoadProfitableFlips" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td>
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.Currency.ToPriceString(item.BuyAskingPrice)</MudText>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Color="Color.Success" Class="NoWrap">
                                                @item.Currency.ToPriceString(item.BuyNowPrice - item.BuyAskingPrice - ((long)Math.Floor(Math.Max(item.BuyNowPrice * EconomyExtensions.FeeMultiplier, 1))))
                                            </MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td>—</td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-dollar-sign" Title="Most Expensive" Subtitle="What are the most expensive items on the market?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadMostProfitable" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.Currency.ToPriceString(item.BuyNowPrice)</MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-crown" Title="Most Popular" Subtitle="What items have the highest number of unique owners (subscribers)?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadMostPopular" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">
                                                <i class="fas fa-fw fa-user"></i>
                                                <span>@item.Subscriptions.ToQuantityString()</span>
                                            </MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>

        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-balance-scale" Title="Most Saturated" Subtitle="What items have the largest supply of listings on the market?"Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <thead>
                            <tr>
                                <th></th>
                                <th class="NoWrap">Supply</th>
                                <th class="NoWrap TextRight">Daily Demand</th>
                            </tr>
                        </thead>
                        <tbody>
                            <Virtualize ItemsProvider="LoadMostSaturated" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Style="@GetItemStyles(item)">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td>
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.Supply.ToQuantityString()</MudText>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">
                                                @if (item.Demand > 0)
                                                {
                                                    <span>@item.Demand.ToQuantityString() sold yesterday</span>
                                                }
                                                else 
                                                {
                                                    <span>None sold yesterday</span>
                                                }
                                            </MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td>—</td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-tshirt" Title="Biggest Collections" Subtitle="Which item collections have the most number of items?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadItemCollections" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ShowItemCollectionDialog(item.Name))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.IconUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2">@item.Name (@item.Items.ToQuantityString())</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">@State.Currency.ToPriceString(item.BuyNowPrice.Value)</MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-user" Title="Biggested Creators" Subtitle="Which skin creators have the most accepted in-game items?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadAcceptedCreators" Context="item">
                                <ItemContent>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <img src="@item.AvatarUrl" class="mr-1" style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2">@item.Name</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">
                                            <MudText Typo="Typo.body2" Class="NoWrap">@item.Items.ToQuantityString() item(s)</MudText>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                        <td class="TextRight">—</td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-box-open" Title="Skin Containers" Subtitle="What is the cheapest way to buy skin containers?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadCraftableContainers" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-start">
                                                <img src="@item.IconUrl" class="mr-2" style="width:64px; height:64px;" />
                                                <div>
                                                    @if (item.CraftingCost > item.BuyNowPrice)
                                                    {
                                                        <MudText Typo="Typo.body2" Color="MudBlazor.Color.Default">Cheapest directly from the market for <strong>@item.Currency.ToPriceString(item.BuyNowPrice)</strong>.</MudText>
                                                        <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Secondary">It would cost <span>@item.Currency.ToPriceString(item.CraftingCost)</span> in resources to craft yourself.</MudText>
                                                    }
                                                    else
                                                    {
                                                        <MudText Typo="Typo.body2" Color="MudBlazor.Color.Default">Cheapest if you buy the resources and craft it for a total of <strong>@item.Currency.ToPriceString(item.CraftingCost)</strong>.</MudText>
                                                        <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Secondary">It would cost <span>@item.Currency.ToPriceString(item.BuyNowPrice)</span> to buy it from the market.</MudText>
                                                    }
                                                    <MudSimpleTable Dense="true" Hover="true" Elevation="0">
                                                        <tbody>
                                                            @foreach(var component in item.CraftingComponents)
                                                            {
                                                                <tr @onclick="@((_) => ViewItem(component.Component))" class="Clickable">
                                                                    <td>
                                                                        <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Secondary">@(component.Quantity)x</MudText>
                                                                    </td>
                                                                    <td>
                                                                        <div class="d-flex flex-row justify-start align-center">
                                                                            <img src="@component.Component.IconUrl" class="mr-1" style="width:24px; height:24px;" />
                                                                            <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Secondary">@component.Component.Name</MudText>
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Secondary">@component.Component.Currency.ToPriceString(component.Component.BuyNowPrice) each</MudText>
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </MudSimpleTable>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
        <MudItem xs="12" md="6" xl="3">
            <StatisticsPanel Icon="fas fa-fw fa-boxes" Title="Crafting Resources" Subtitle="What is the cheapest way to buy crafting resources?" Dense="true">
                <div class="VirtualTablePanel flex-grow-1">
                    <MudSimpleTable Dense="true" Hover="true">
                        <tbody>
                            <Virtualize ItemsProvider="LoadCraftingResources" Context="item">
                                <ItemContent>
                                    <tr @onclick="@((_) => ViewItem(item.CheapestItem.BuyNowPrice > item.BuyNowPrice ? item : item.CheapestItem))" class="Clickable">
                                        <td>
                                            <div class="d-flex flex-row justify-start align-start">
                                                <img src="@item.IconUrl" class="mr-2" style="width:64px; height:64px;" />
                                                <div>
                                                    @if (item.CheapestItem.BuyNowPrice > item.BuyNowPrice)
                                                    {
                                                        <MudText Typo="Typo.body2" Color="MudBlazor.Color.Default">Cheapest directly from the market for <strong>@item.Currency.ToPriceString(item.BuyNowPrice)</strong>.</MudText>
                                                        <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Secondary">You can also buy <span>@item.CheapestItem.Name</span> for <span>@item.Currency.ToPriceString(item.CheapestItem.BuyNowPrice)</span> and break it down using the Rust in-game workshop.</MudText>
                                                    }
                                                    else
                                                    {
                                                        <MudText Typo="Typo.body2" Color="MudBlazor.Color.Default">Cheapest if you buy <strong>@item.CheapestItem.Name</strong> for <strong>@item.Currency.ToPriceString(item.CheapestItem.BuyNowPrice)</strong> and break it down using the Rust in-game workshop.</MudText>
                                                        <MudText Typo="Typo.subtitle2" Color="MudBlazor.Color.Secondary">It would cost <span>@item.Currency.ToPriceString(item.BuyNowPrice)</span> to buy it from the market.</MudText>
                                                    }
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </ItemContent>
                                <Placeholder>
                                    <tr>
                                        <td>
                                            <div class="d-flex flex-row justify-start align-center">
                                                <MudProgressCircular Indeterminate="true" Class="mr-1" Style="width:32px; height:32px;" />
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">Loading...</MudText>
                                            </div>
                                        </td>
                                    </tr>
                                </Placeholder>
                            </Virtualize>
                        </tbody>
                    </MudSimpleTable>
                </div>
            </StatisticsPanel>
        </MudItem>
    
    </MudGrid>

</PageContainer>

@code {

    private void ViewItem(ISteamMarketListing item)
    {
        ExternalNavigationManager.NavigateToNewTab(
            $"https://steamcommunity.com/market/listings/{item.SteamAppId}/{Uri.EscapeDataString(item.Name)}"
        );
    }
    
    private void ViewProfile(string steamId)
    {
        ExternalNavigationManager.NavigateToNewTab(
            $"https://steamcommunity.com/profiles/{steamId}"
        );
    }
    
    private void ShowItemCollectionDialog(string itemCollection)
    {
        Dialogs.Show<ViewItemCollectionDialog>(null, parameters: new DialogParameters()
        {
            ["CollectionName"] = itemCollection,
            ["CollectionUrl"] = $"api/item/collection/{itemCollection}"
        });
    }
    
    private string GetItemStyles(ISteamAssetStyles item)
    {
        return $"color: {item.ForegroundColour}";
    }

    protected async ValueTask<ItemsProviderResult<DashboardAssetSalesDTO>> LoadHotRightNow(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetSalesDTO>>($"api/market/stat/hotRightNow?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetSalesDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'hot right now' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetAgeDTO>> LoadMostRecent(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetAgeDTO>>($"api/market/stat/mostRecent?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetAgeDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most recent' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetMarketValueDTO>> LoadAllTimeHigh(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetMarketValueDTO>>($"api/market/stat/allTimeHigh?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetMarketValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'all time high' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetMarketValueDTO>> LoadAllTimeLow(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetMarketValueDTO>>($"api/market/stat/allTimeLow?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetMarketValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'all time low' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetBuyOrderValueDTO>> LoadProfitableFlips(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetBuyOrderValueDTO>>($"api/market/stat/profitableFlips?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetBuyOrderValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'profitable flips' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetMarketValueDTO>> LoadMostProfitable(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetMarketValueDTO>>($"api/market/stat/mostProfitable?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetMarketValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most profitable' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetSubscriptionsDTO>> LoadMostPopular(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetSubscriptionsDTO>>($"api/market/stat/mostPopular?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetSubscriptionsDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most popular' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetSupplyDemandDTO>> LoadMostSaturated(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetSupplyDemandDTO>>($"api/market/stat/mostSaturated?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetSupplyDemandDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'most staurated' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardProfileWorkshopValueDTO>> LoadAcceptedCreators(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardProfileWorkshopValueDTO>>($"api/market/stat/acceptedCreators?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardProfileWorkshopValueDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'accepted creators' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardAssetCollectionDTO>> LoadItemCollections(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardAssetCollectionDTO>>($"api/market/stat/collections?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardAssetCollectionDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'item collections' market dashboard");
            throw;
        }
    }
    
    protected async ValueTask<ItemsProviderResult<DashboardCraftingResourceCostDTO>> LoadCraftingResources(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardCraftingResourceCostDTO>>($"api/market/stat/craftingResources?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardCraftingResourceCostDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'crafting resources' market dashboard");
            throw;
        }
    }

    protected async ValueTask<ItemsProviderResult<DashboardCraftableContainerCostDTO>> LoadCraftableContainers(ItemsProviderRequest request)
    {
        try
        {
            var response = await Http.GetFromJsonAsync<PaginatedResult<DashboardCraftableContainerCostDTO>>($"api/market/stat/craftableContainers?start={request.StartIndex}&count={request.Count}");
            return new ItemsProviderResult<DashboardCraftableContainerCostDTO>(response.Items, response.Total);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error listing 'craftable containers' market dashboard");
            throw;
        }
    }
}
